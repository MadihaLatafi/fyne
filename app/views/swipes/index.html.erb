<!-- Setting variables -->

<% array_of_swiped_events = @swipes_liked.map { |swipe| swipe.event } %>

<% array_of_dates = array_of_swiped_events.map { |event| event.start_time }.sort!  %>
<% array_of_dates.map!{|date| date.strftime('%A %dth, %b %Y') }.uniq! %>

<!-- Display -->

<%= render 'shared/navbar', profile_color: "inactive", calendar_color: "active", fyne_color: "inactive" %>

<div class="container-fyne">

  <div class="text-center btn-group-fyne">
      <%= link_to events_path, class: "btn btn-primary btn-event-index btn-fyne", id: "btn-create-new-event" do %>
        <i class="fa fa-calendar-o" aria-hidden="true"></i>
        <span class="inline">See my events</span>
      <% end %>
      <%= link_to new_event_path, class: "btn btn-primary btn-fyne", id: "btn-create-new-event" do %>
        <i class="fa fa-plus-square" aria-hidden="true" ></i>
        <span>Create an event</span>
      <% end %>
  </div>
</div>

<hr id="large-line">

<h1 class="text-center">Events you liked</h1>
<br>

<div class="tabs tabs-fyne">
  <a href="#" class="tab active" data-target="all">
    All
  </a>
  <a href="#" class="tab" data-target="today">
    Today
  </a>
  <a href="#" class="tab" data-target="tomorrow">
    Tomorrow
  </a>
  <a href="#" class="tab" data-target="this_weekend">
    This weekend
  </a>
</div>


<div class="tab-content" id="all">
  <div class="container-fyne">
    <div class="cards-container-index">

      <% array_of_dates.each do |date| %>
        <% if date >= Date.today.strftime('%A %dth, %b %Y') %>
          <h2><%= date %></h2>
          <% array_of_swiped_events.each do |event| %>
            <% if event.start_time.strftime('%A %dth, %b %Y') == date %>
              <%= render 'shared/cards', event: event %>
            <% end %>
          <% end %>
        <% end %>
      <% end %>

    </div>
  </div>
</div>


<div class="tab-content hidden" id="today">
  <div class="container-fyne">
    <div class="cards-container-index">

      <% array_of_dates.each do |date| %>
        <% if date == Date.today.strftime('%A %dth, %b %Y') %>
          <h2><%= date %></h2>
          <% array_of_swiped_events.each do |event| %>
            <% if event.start_time.strftime('%A %dth, %b %Y') == date %>
              <%= render 'shared/cards', event: event %>
            <% end %>
          <% end %>
        <% end %>
      <% end %>

    </div>
  </div>
</div>

<div class="tab-content hidden" id="tomorrow">
  <div class="container-fyne">
    <div class="cards-container-index">

      <% array_of_dates.each do |date| %>
        <% if date == Date.tomorrow.strftime('%A %dth, %b %Y') %>
          <h2><%= date %></h2>
          <% array_of_swiped_events.each do |event| %>
            <% if event.start_time.strftime('%A %dth, %b %Y') == date %>
              <%= render 'shared/cards', event: event %>
            <% end %>
          <% end %>
        <% end %>
      <% end %>

    </div>
  </div>
</div>

<div class="tab-content hidden" id="this_weekend">
  <div class="container-fyne">
    <div class="cards-container-index">

      <% array_of_dates.each do |date| %>
        <% if date == DateTime.now.end_of_week.yesterday.strftime('%A %dth, %b %Y') %>
          <h2><%= date %></h2>
          <% array_of_swiped_events.each do |event| %>
            <% if event.start_time.strftime('%A %dth, %b %Y') == date %>
              <%= render 'shared/cards', event: event %>
            <% end %>
          <% end %>
        <% end %>
      <% end %>

      <% array_of_dates.each do |date| %>
        <% if date == DateTime.now.end_of_week.strftime('%A %dth, %b %Y') %>
          <h2><%= date %></h2>
          <% array_of_swiped_events.each do |event| %>
            <% if event.start_time.strftime('%A %dth, %b %Y') == date %>
              <%= render 'shared/cards', event: event %>
            <% end %>
          <% end %>
        <% end %>
      <% end %>

    </div>
  </div>
</div>

<% content_for(:js) do %>
  <%= javascript_tag do %>
const tabs = document.querySelectorAll('.tab')
const tabContents = document.querySelectorAll('.tab-content')


tabs.forEach((tab) => {
  tab.addEventListener('click', (event) => {
    event.preventDefault();
    let target = event.currentTarget.dataset.target
    clearTabContents()
    document.getElementById(target).classList.remove('hidden')
  clearTabs()
  tab.classList.add('active')
  })
})


function clearTabContents() {
  tabContents.forEach((tabContent) => {
    tabContent.classList.add('hidden')
  })
}

function clearTabs() {
  tabs.forEach((tab) => {
    tab.classList.remove('active')
  })
}

  <% end %>
<% end %>

